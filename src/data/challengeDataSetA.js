// Complete challenge data for your treasure hunt - Set A with FIXED user-specific randomization
// FIXED VERSION - Eliminates "Challenge Data Missing" and "Same Question Loop" bugs

// Challenge Set A
// 20 Picture Challenges + 20 Riddle Challenges

export const ORIGINAL_CHALLENGES_SET_A = [
  {
    id: 0,
    type: 'picture',
    title: 'Where Could This Be?',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/MathematicsDepartment_.jpg',
    targetLocation: {
      latitude: 12.924031356648811,
      longitude: 77.50118731104367,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 1,
    type: 'picture',
    title: 'Match the Picture to the Place',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/RVU stairs.jpg',
    targetLocation: {
      latitude: 12.923653671176949,
      longitude: 77.50136112453583,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 2,
    type: 'picture',
    title: 'Where Could This Be?',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/ISE Tree.jpg',
    targetLocation: {
      latitude: 12.923640357042123,
      longitude: 77.50095672453588,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 3,
    type: 'picture',
    title: 'Match the Picture to the Place',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Temple.jpg',
    targetLocation: {
      latitude: 12.924823113712105,
      longitude: 77.50092295152024,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 4,
    type: 'picture',
    title: 'Look Closely, Seek Wisely ',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/CCAV.jpg',
    targetLocation: {
      latitude: 12.924696970039946,
      longitude: 77.49984123802811,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 5,
    type: 'picture',
    title: 'Where Could This Be?',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Main Ground_.jpg',
    targetLocation: {
      latitude: 12.924823898827015,
      longitude: 77.50002602453591,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 6,
    type: 'picture',
    title: 'Your Next Destination Awaits',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Kotak Bank_.jpg',
    targetLocation: {
      latitude: 12.92509375557992,
      longitude: 77.49938825337182,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 7,
    type: 'picture',
    title: 'Match the Picture to the Place',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Airplane_.jpg',
    targetLocation: {
      latitude: 12.924519656157495,
      longitude: 77.49914236686402,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 8,
    type: 'picture',
    title: 'Where Could This Be?',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Kriyapalpa_.jpg',
    targetLocation: {
      latitude: 12.924174456504822,
      longitude: 77.49956678220778,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 9,
    type: 'picture',
    title: 'Your Next Destination Awaits',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/MM Foods.jpg',
    targetLocation: {
      latitude: 12.923630186327935,
      longitude: 77.49985499569993,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 10,
    type: 'picture',
    title: 'Match the Picture to the Place',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Place between Chemical, Library and ETE.jpg',
    targetLocation: {
      latitude: 12.923069043926802,
      longitude: 77.50048203804349,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 11,
    type: 'picture',
    title: 'Look Closely, Seek Wisely',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Mechanical PG Block.jpg',
    targetLocation: {
      latitude: 12.923619343658839,
      longitude: 77.4983475245509,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 12,
    type: 'picture',
    title: 'Where Could This Be?',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/CSE Department_.jpg',
    targetLocation: {
      latitude: 12.924452156954706,
      longitude: 77.50010366686402,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 13,
    type: 'picture',
    title: 'Match the Picture to the Place',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Ashwa racing_.jpg',
    targetLocation: {
      latitude: 12.923132444178584,
      longitude: 77.49787596688786,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 14,
    type: 'picture',
    title: 'Your Next Destination Awaits',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Civil department_.jpg',
    targetLocation: {
      latitude: 12.924506428022577,
      longitude: 77.49946733802808,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 15,
    type: 'picture',
    title: 'Find the Spot',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/EEE Department_.jpg',
    targetLocation: {
      latitude: 12.92433519616346,
      longitude: 77.50009680113578,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 16,
    type: 'picture',
    title: 'Your Next Destination Awaits',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Chemical_.jpg',
    targetLocation: {
      latitude: 12.92366235702001,
      longitude: 77.49999070919209,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 17,
    type: 'picture',
    title: 'Look Closely, Seek Wisely',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/ETE steps.jpg',
    targetLocation: {
      latitude: 12.923722761200711,
      longitude: 77.50014816774578,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 18,
    type: 'picture',
    title: 'Where Could This Be?',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/Health Centre.jpg',
    targetLocation: {
      latitude: 12.924459604639114,
      longitude: 77.50068331671172,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 19,
    type: 'picture',
    title: 'Match the Picture to the Place',
    description: 'Find the Location in the Image and click Verify Location!',
    imageUrl: '/images/challenges/IEM Auditorium_.jpg',
    targetLocation: {
      latitude: 12.923100148722689,
      longitude: 77.4985066217639,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 20,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'Buttons hum and lights glow bright, Coins go in and treats come out at night. Press a number, wait a beat—Find your snack where metal and hunger meet.',
    targetLocation: {
      latitude: 12.923743399868828,
      longitude: 77.500619438028,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 21,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'From tiny chips to waves in the air, I connect people here and there. Without me, phones would just be stone, Find the place where signals are grown.',
    targetLocation: {
      latitude: 12.923947975061562,
      longitude: 77.49992614115814,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 22,
    type: 'riddle',
    title: 'Decode the Scene',
    description: '11-18-9-19-8-14-1 8-15-19-20-5-12 (Hint: Number substitution A=1, B=2, C=3... Z=26)',
    targetLocation: {
      latitude: 12.924123157189314,
      longitude: 77.50044850919215,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 23,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'KEVYHE (Hint: Shift letters back by 4 positions in the alphabet)',
    targetLocation: {
      latitude: 12.923390643124943,
      longitude: 77.49790165152028,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 24,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I am a shelter of minds that race, Where wheels, wings, and stars find their place. From the spark of light to the roar of speed, I\'m the ground where new ideas breed. What am I?',
    targetLocation: {
      latitude: 12.923686156996041,
      longitude: 77.4979171957,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 25,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'Where voices travel without a sound, And signals bridge both sky and ground. Steps in tiers, like waves they flow, Find the place where networks grow.',
    targetLocation: {
      latitude: 12.923722761200711,
      longitude: 77.50014816774578,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 26,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'A canvas of colors watches from above, Patterns of art where shapes interweave. Not of stone alone, nor only of glass, A modern hall where many paths pass. Seek the doorway beneath its gaze, Where knowledge awaits in quiet maze.',
    targetLocation: {
      latitude: 12.922607163215126,
      longitude: 77.49998488720018,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 27,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'Though no teacher stands to speak, I\'m a place where new life you can seek. Behind my fence of gilded hue, I hold the green, the fresh, the new. Where seedlings rise and lessons start, you will find the garden\'s heart.',
    targetLocation: {
      latitude: 12.922791687506452,
      longitude: 77.49953175383511,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 28,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'You\'ll know me by my colors, yellow and bright red, the exterior of a place where machines are fed. Inside, massive computers hum and learn, as lines of code and models take their turn. It\'s a hub for minds to build and to train, the future of technology that will one day reign.',
    targetLocation: {
      latitude: 12.922804839034336,
      longitude: 77.49937318742167,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 29,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I hide between two worlds of code, Where algorithms and apps are sowed. Palm trees guard my quiet ground, Yet few may know where I am found. Not a hall, but open sky, A secret garden where minds pass by.',
    targetLocation: {
      latitude: 12.92256672964908,
      longitude: 77.49867562453585,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 30,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'Where cells divide and science thrives, I\'m a bustling spot for countless lives. My steps become a stage for crowds, where cheers and chants rise into the clouds. I am not the lab, but I am in sight. What am I?',
    targetLocation: {
      latitude: 12.922719906173793,
      longitude: 77.49864111902738,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 31,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I stand with pillars, shaded and tall, Guarding the memory that started it all. Steps lead up where silence stays, Honoring vision in timeless ways. Not a classroom, yet wisdom I hold—Find the heart where stories are told.',
    targetLocation: {
      latitude: 12.922737429505942,
      longitude: 77.4982588091921,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 32,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I sit outside the hall of books, a shady place with quiet nooks. I\'m a campus crossroads for minds to meet, surrounded by buildings on every street.',
    targetLocation: {
      latitude: 12.92303287185346,
      longitude: 77.50059822453589,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 33,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I stand beneath the open sky, where branches wave as people walk by. My tables fill with plates of food, and stories shared in a lively mood. Step through my door and you will see, a bustling heart of hospitality.',
    targetLocation: {
      latitude: 12.922534315436693,
      longitude: 77.49976012270945,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 34,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I have a natural facade of stone and of wood, but inside my walls, a different world has stood. Here, fingers fly across screens alight, as ideas and codes take their digital flight. A meeting place for a collaborative mind, what am I?',
    targetLocation: {
      latitude: 12.923644328745457,
      longitude: 77.49786355152031,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 35,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I house machines, though none are at rest, Where minds and engines are put to the test. With wheels and gears, the future I steer, Innovation and learning are nurtured here. A name of wisdom stands with a car\'s might, Can you tell me who I am, shining bright?',
    targetLocation: {
      latitude: 12.923207786576,
      longitude: 77.49789742453584,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 36,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I am the place where wheels are many, Engines roar though the halls seem empty. Two names I hold, one of horse and one of sun, Together they build machines that run. Where are you?',
    targetLocation: {
      latitude: 12.923286686132819,
      longitude: 77.49792961104366,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 37,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I sit between minds that never rest, Where formulas, signals, and knowledge are blessed. A patch of green, where footsteps slow, Students gather, then off they go. Not a class, yet lessons stay, In whispered talks or a tired break\'s way. Between four halls of wisdom\'s might, What am I, a calm in sight?',
    targetLocation: {
      latitude: 12.923069043926802,
      longitude: 77.50048203804349,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 38,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'Through a leafy lane, a path I weave, where tired students, a sigh of relief, find rest in my shelter, a welcome space, a second home in this busy place. What am I?',
    targetLocation: {
      latitude: 12.923967585533395,
      longitude: 77.50093512268437,
      name: ''
    },
    marginOfError: 50,
    points: 10
  },
  {
    id: 39,
    type: 'riddle',
    title: 'Decode the Scene',
    description: 'I am not the bank, though I rest nearby, Ideas are my currency, algorithms I supply. Between the entrance and the civil domain, Students debug here again and again. Who am I?',
    targetLocation: {
        latitude: 12.924541086778179,
        longitude: 77.49921151352048,
        name: ''
    },
    marginOfError: 50,
    points: 10
  }
];

// ===============================================
// FIXED RANDOMIZATION SYSTEM
// ===============================================

// Robust seeded random number generator (Mulberry32)
function createSeededRandom(seed) {
  return function() {
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  };
}

// Convert string to robust numeric seed
function stringToSeed(str) {
  let hash = 0;
  if (str.length === 0) return hash;
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash; // Convert to 32-bit integer
  }
  // Ensure positive seed
  return Math.abs(hash) + 1;
}

// Deterministic Fisher-Yates shuffle
function deterministicShuffle(array, seed) {
  const shuffled = [...array]; // Deep copy to avoid mutation
  const random = createSeededRandom(seed);
  
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  
  return shuffled;
}

// ===============================================
// THREAD-SAFE CACHING SYSTEM
// ===============================================

// Global cache with user-specific locks
const userChallengesCache = new Map();
const userProcessingLocks = new Map();

// Thread-safe challenge loader
async function loadUserChallengesThreadSafe(userId) {
  // Return cached version if available
  if (userChallengesCache.has(userId)) {
    return userChallengesCache.get(userId);
  }

  // Check if another thread is processing this user
  if (userProcessingLocks.has(userId)) {
    // Wait for other thread to complete
    await userProcessingLocks.get(userId);
    return userChallengesCache.get(userId);
  }

  // Create processing lock for this user
  let resolveLock;
  const lockPromise = new Promise(resolve => {
    resolveLock = resolve;
  });
  userProcessingLocks.set(userId, lockPromise);

  try {
    // Generate deterministic seed from userId
    const seed = stringToSeed(userId);
    
    // Create shuffled challenges with original IDs preserved
    const shuffledChallenges = deterministicShuffle(ORIGINAL_CHALLENGES_SET_A, seed);
    
    // Reassign sequential IDs while preserving original data
    const reindexedChallenges = shuffledChallenges.map((challenge, index) => ({
      ...challenge, // Preserve ALL original data
      id: index,    // New sequential ID (0-39)
      originalId: challenge.id, // Keep track of original ID
      userId: userId, // Add user identifier
      shuffleSeed: seed // Store seed for debugging
    }));

    // Validate all challenges are present
    if (reindexedChallenges.length !== 40) {
      throw new Error(`Invalid challenge count: ${reindexedChallenges.length}, expected 40`);
    }

    // Validate no duplicate IDs
    const ids = reindexedChallenges.map(c => c.id);
    const uniqueIds = new Set(ids);
    if (uniqueIds.size !== 40) {
      throw new Error(`Duplicate challenge IDs detected`);
    }

    // Validate all challenges have required properties
    for (const challenge of reindexedChallenges) {
      if (!challenge.title || !challenge.description || !challenge.targetLocation) {
        throw new Error(`Invalid challenge data at ID ${challenge.id}`);
      }
    }

    // Store in cache
    userChallengesCache.set(userId, reindexedChallenges);
    
    console.log(`✅ Successfully loaded ${reindexedChallenges.length} challenges for user: ${userId}`);
    return reindexedChallenges;
    
  } catch (error) {
    console.error(`❌ Error loading challenges for user ${userId}:`, error);
    throw error;
  } finally {
    // Release lock
    userProcessingLocks.delete(userId);
    resolveLock();
  }
}

// ===============================================
// PUBLIC API FUNCTIONS
// ===============================================

// Get challenges shuffled for specific user
export async function getChallengesForUser(userId) {
  // Validate userId
  if (!userId || typeof userId !== 'string') {
    console.warn('❌ Invalid userId provided, returning original order');
    return ORIGINAL_CHALLENGES_SET_A.map((challenge, index) => ({
      ...challenge,
      id: index,
      originalId: challenge.id
    }));
  }

  try {
    return await loadUserChallengesThreadSafe(userId);
  } catch (error) {
    console.error('❌ Failed to get challenges for user, falling back to original order:', error);
    // Fallback to original order if shuffling fails
    return ORIGINAL_CHALLENGES_SET_A.map((challenge, index) => ({
      ...challenge,
      id: index,
      originalId: challenge.id,
      fallback: true
    }));
  }
}

// Get specific challenge by ID for a user
export async function getChallengeById(id, userId = null) {
  // Validate ID
  if (typeof id !== 'number' || id < 0 || id >= 40) {
    console.error(`❌ Invalid challenge ID: ${id}`);
    return null;
  }

  try {
    if (userId) {
      // Get user-specific shuffled challenges
      const userChallenges = await getChallengesForUser(userId);
      const challenge = userChallenges.find(challenge => challenge.id === id);
      
      if (!challenge) {
        console.error(`❌ Challenge with ID ${id} not found for user ${userId}`);
        return null;
      }
      
      return challenge;
    } else {
      // Fallback to original array if no userId provided
      const challenge = ORIGINAL_CHALLENGES_SET_A.find(challenge => challenge.id === id);
      
      if (!challenge) {
        console.error(`❌ Challenge with original ID ${id} not found`);
        return null;
      }
      
      return {
        ...challenge,
        originalId: challenge.id,
        fallback: true
      };
    }
  } catch (error) {
    console.error(`❌ Error getting challenge by ID ${id}:`, error);
    return null;
  }
}

// ===============================================
// UTILITY FUNCTIONS
// ===============================================

// Clear cache for a specific user (useful for testing)
export function clearUserCache(userId) {
  if (userChallengesCache.has(userId)) {
    userChallengesCache.delete(userId);
    console.log(`🧹 Cleared cache for user: ${userId}`);
  }
}

// Clear all caches (admin function)
export function clearAllCaches() {
  userChallengesCache.clear();
  userProcessingLocks.clear();
  console.log('🧹 Cleared all challenge caches');
}

// Get cache statistics (admin function)
export function getCacheStats() {
  return {
    cachedUsers: userChallengesCache.size,
    processingUsers: userProcessingLocks.size,
    totalChallenges: ORIGINAL_CHALLENGES_SET_A.length
  };
}

// Validate challenge data integrity
export function validateChallengeData() {
  const issues = [];
  
  // Check total count
  if (ORIGINAL_CHALLENGES_SET_A.length !== 40) {
    issues.push(`Invalid total count: ${ORIGINAL_CHALLENGES_SET_A.length}, expected 40`);
  }
  
  // Check for duplicate IDs
  const ids = ORIGINAL_CHALLENGES_SET_A.map(c => c.id);
  const uniqueIds = new Set(ids);
  if (uniqueIds.size !== 40) {
    issues.push('Duplicate IDs found');
  }
  
  // Check each challenge
  ORIGINAL_CHALLENGES_SET_A.forEach((challenge, index) => {
    if (challenge.id !== index) {
      issues.push(`Challenge at index ${index} has incorrect ID: ${challenge.id}`);
    }
    
    if (!challenge.title || !challenge.description) {
      issues.push(`Challenge ${challenge.id} missing title or description`);
    }
    
    if (!challenge.targetLocation || !challenge.targetLocation.latitude || !challenge.targetLocation.longitude) {
      issues.push(`Challenge ${challenge.id} missing valid location`);
    }
    
    if (!challenge.type || (challenge.type !== 'picture' && challenge.type !== 'riddle')) {
      issues.push(`Challenge ${challenge.id} has invalid type: ${challenge.type}`);
    }
    
    if (typeof challenge.points !== 'number' || challenge.points <= 0) {
      issues.push(`Challenge ${challenge.id} has invalid points: ${challenge.points}`);
    }
  });
  
  return {
    isValid: issues.length === 0,
    issues: issues,
    totalChallenges: ORIGINAL_CHALLENGES_SET_A.length
  };
}

// ===============================================
// BACKWARD COMPATIBILITY EXPORTS
// ===============================================

// Maintain backward compatibility
export const CHALLENGES_SET_A = ORIGINAL_CHALLENGES_SET_A;

// Export validation function for immediate use
export function runValidation() {
  const validation = validateChallengeData();
  if (validation.isValid) {
    console.log('✅ Challenge data validation passed');
  } else {
    console.error('❌ Challenge data validation failed:', validation.issues);
  }
  return validation;
}

// Auto-run validation on module load
runValidation();